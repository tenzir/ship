name: Release

on:
  workflow_call:
    inputs:
      bump:
        description: "Version bump type: major, minor, or patch"
        required: true
        type: string
      intro:
        description: "1-2 sentence release introduction"
        required: true
        type: string
      title:
        description: "User-facing release title (empty = auto-generated)"
        required: false
        default: ""
        type: string
      changelog-root:
        description: "Project root for --root flag"
        required: false
        default: "."
        type: string
      git-add-paths:
        description: "Space-separated extra paths to stage before publish"
        required: false
        default: ""
        type: string
      pre-create:
        description: "Shell script for quality gates (runs before release create)"
        required: false
        default: ""
        type: string
      post-create:
        description: "Shell script for version bumping (runs after release create)"
        required: false
        default: ""
        type: string
    outputs:
      version:
        description: "Created release version tag (for example v1.2.3)"
        value: ${{ jobs.release.outputs.version }}
      is_latest:
        description: "Whether the release was created from the main branch"
        value: ${{ jobs.release.outputs.is_latest }}

jobs:
  release:
    uses: ./.github/workflows/reusable-release-advanced.yaml
    with:
      bump: ${{ inputs.bump }}
      intro: ${{ inputs.intro }}
      title: ${{ inputs.title }}
      changelog-root: ${{ inputs.changelog-root }}
      git-add-paths: ${{ inputs.git-add-paths }}
      pre-create: ${{ inputs.pre-create }}
      post-create: ${{ inputs.post-create }}
      pre-publish: ""
      post-publish: ""
      skip-publish: false
      publish-no-latest-on-non-main: false
      copy-release-to-main-on-non-main: false
      update-latest-branch-on-main: false
    secrets: inherit
